<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üéÑ Weihnachtsr√§tsel - Strands</title>
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(
                    135deg,
                    #1a472a 0%,
                    #2d5a3d 50%,
                    #1a472a 100%
                );
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                color: white;
            }
            .snowflakes {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                overflow: hidden;
                z-index: 0;
            }
            .snowflake {
                position: absolute;
                top: -10px;
                color: white;
                font-size: 1.5em;
                opacity: 0.8;
                animation: fall linear infinite;
            }
            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                }
            }
            .container {
                position: relative;
                z-index: 1;
                max-width: 600px;
                width: 100%;
            }
            h1 {
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            }
            .subtitle {
                text-align: center;
                margin-bottom: 20px;
                font-size: 1.1em;
                opacity: 0.9;
            }
            .theme-hint {
                background: rgba(255, 255, 255, 0.15);
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 20px;
                text-align: center;
            }
            .theme-hint h3 {
                color: #ffd700;
                margin-bottom: 5px;
            }
            .found-words {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                margin-bottom: 20px;
            }
            .found-word {
                background: rgba(255, 255, 255, 0.2);
                padding: 8px 15px;
                border-radius: 20px;
                font-weight: bold;
                transition: all 0.3s;
            }
            .found-word.found {
                background: #4caf50;
                transform: scale(1.05);
            }
            .grid-container {
                display: flex;
                justify-content: center;
                margin-bottom: 20px;
            }
            .grid {
                display: grid;
                gap: 4px;
                background: rgba(0, 0, 0, 0.3);
                padding: 10px;
                border-radius: 10px;
            }
            .cell {
                width: 48px;
                height: 48px;
                background: rgba(255, 255, 255, 0.9);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5em;
                font-weight: bold;
                color: #333;
                cursor: pointer;
                user-select: none;
                transition: all 0.2s;
            }
            .cell:hover {
                background: #fff;
                transform: scale(1.05);
            }
            .cell.selected {
                background: #ffd700;
                color: #333;
            }
            .cell.found {
                background: #4caf50;
                color: white;
            }
            .cell.spangram {
                background: #e91e63;
                color: white;
            }
            .current-word {
                text-align: center;
                font-size: 1.5em;
                margin-bottom: 15px;
                min-height: 40px;
                color: #ffd700;
                font-weight: bold;
            }
            .buttons {
                display: flex;
                gap: 10px;
                justify-content: center;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }
            button {
                padding: 12px 25px;
                font-size: 1em;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: bold;
            }
            .btn-clear {
                background: #f44336;
                color: white;
            }
            .btn-submit {
                background: #4caf50;
                color: white;
            }
            .btn-hint {
                background: #ff9800;
                color: white;
            }
            button:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
            .progress {
                text-align: center;
                font-size: 1.2em;
                margin-bottom: 20px;
            }
            .message {
                text-align: center;
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 20px;
                font-weight: bold;
                display: none;
            }
            .message.success {
                background: #4caf50;
                display: block;
            }
            .message.error {
                background: #f44336;
                display: block;
                animation: shake 0.5s;
            }
            @keyframes shake {
                0%,
                100% {
                    transform: translateX(0);
                }
                25% {
                    transform: translateX(-10px);
                }
                75% {
                    transform: translateX(10px);
                }
            }
            .next-button {
                display: none;
                margin: 20px auto;
                padding: 15px 40px;
                font-size: 1.3em;
                background: linear-gradient(135deg, #ffd700, #ffaa00);
                color: #333;
                border: none;
                border-radius: 30px;
                cursor: pointer;
                animation: pulse 2s infinite;
            }
            .next-button.visible {
                display: block;
            }
            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
                }
                50% {
                    transform: scale(1.05);
                    box-shadow: 0 0 20px 10px rgba(255, 215, 0, 0);
                }
            }
            .instructions {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 20px;
                font-size: 0.9em;
            }
            .instructions h4 {
                margin-bottom: 10px;
                color: #ffd700;
            }
            .instructions ul {
                margin-left: 20px;
            }
            .instructions li {
                margin-bottom: 5px;
            }
            .validation-error {
                background: #ff5722;
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                display: none;
            }
            .validation-error.visible {
                display: block;
            }
            .validation-error ul {
                margin-left: 20px;
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <div class="snowflakes" id="snowflakes"></div>
        <div class="container">
            <h1>üéÑ Weihnachtsr√§tsel üéÑ</h1>
            <p class="subtitle">Spiel 1 von 3: Strands</p>
            <div class="instructions">
                <h4>üìñ Anleitung</h4>
                <ul>
                    <li>Finde alle versteckten W√∂rter zum Thema!</li>
                    <li>Ziehe √ºber benachbarte Buchstaben (auch diagonal!)</li>
                    <li>
                        Das <strong style="color: #e91e63">Spangram</strong> ist
                        das lange Hauptwort
                    </li>
                    <li>
                        Die W√∂rter schl√§ngeln sich - nicht nur horizontal! üêç
                    </li>
                </ul>
            </div>
            <div class="validation-error" id="validation-error">
                <h4>‚ö†Ô∏è Konfigurationsfehler</h4>
                <p>Folgende W√∂rter sind nicht auffindbar:</p>
                <ul id="error-list"></ul>
            </div>
            <div class="theme-hint">
                <h3>üéØ Thema</h3>
                <p id="theme-text">Wird geladen...</p>
            </div>
            <div class="found-words" id="found-words"></div>
            <div class="progress">
                Gefunden: <span id="found-count">0</span> /
                <span id="total-count">0</span>
            </div>
            <div class="current-word" id="current-word"></div>
            <div class="grid-container"><div class="grid" id="grid"></div></div>
            <div class="buttons">
                <button class="btn-clear" onclick="clearSelection()">
                    ‚úñ L√∂schen
                </button>
                <button class="btn-submit" onclick="submitWord()">
                    ‚úì Pr√ºfen
                </button>
                <button class="btn-hint" onclick="showHint()">
                    üí° Hinweis (<span id="hints-left">3</span>)
                </button>
            </div>
            <div class="message" id="message"></div>
            <button class="next-button" id="next-button" onclick="goToNext()">
                üéÅ Weiter zu Spiel 2 ‚Üí
            </button>
        </div>

        <script>
            // ============================================================
            // üéÆ KONFIGURATIONSBEREICH - HIER KANNST DU ALLES ANPASSEN! üéÆ
            // ============================================================
            //
            // Gitter-Visualisierung (6x6):
            //
            //     0 1 2 3 4 5
            //   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            // 0 ‚îÇ Z T M I G I ‚îÇ
            // 1 ‚îÇ I L B A U L ‚îÇ
            // 2 ‚îÇ P I R I T O ‚îÇ
            // 3 ‚îÇ L S I O A D ‚îÇ
            // 4 ‚îÇ Z E K P E A ‚îÇ
            // 5 ‚îÇ G A R T C H ‚îÇ
            //   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            //
            // W√∂rter und ihre verschlungenen Pfade:
            // - MARIOKART: M(0,2)‚ÜíA(1,3)‚ÜíR(2,2)‚ÜíI(2,3)‚ÜíO(3,3)‚ÜíK(4,2)‚ÜíA(5,1)‚ÜíR(5,2)‚ÜíT(5,3) ‚Üê Spangram!
            // - BLITZ: B(1,2)‚ÜíL(1,1)‚ÜíI(2,1)‚ÜíT(0,1)‚ÜíZ(0,0)
            // - PILZ: P(2,0)‚ÜíI(1,0)‚ÜíL(1,1)‚ÜíZ(0,0)
            // - LUIGI: L(1,5)‚ÜíU(1,4)‚ÜíI(0,5)‚ÜíG(0,4)‚ÜíI(0,3)
            // - PEACH: P(4,3)‚ÜíE(4,4)‚ÜíA(4,5)‚ÜíC(5,4)‚ÜíH(5,5)
            // - TOAD: T(2,4)‚ÜíO(2,5)‚ÜíA(3,4)‚ÜíD(3,5)
            // - SIEG: S(3,1)‚ÜíI(3,2)‚ÜíE(4,1)‚ÜíG(5,0)
            //
            // ============================================================

            const CONFIG = {
                theme: "Auf der Rennstrecke üèéÔ∏è",
                rows: 6,
                cols: 6,

                // Das Buchstabengitter - jeder Buchstabe wird genutzt!
                grid: [
                    "ZTMIGI",
                    "ILBAUL",
                    "PIRITO",
                    "LSIOAD",
                    "ZEKPEA",
                    "GARTCH",
                ],

                // Die zu findenden W√∂rter
                words: [
                    { word: "MARIOKART", isSpangram: true }, // Das lange Spangram!
                    { word: "BLITZ", isSpangram: false },
                    { word: "PILZ", isSpangram: false },
                    { word: "LUIGI", isSpangram: false },
                    { word: "PEACH", isSpangram: false },
                    { word: "TOAD", isSpangram: false },
                    { word: "SIEG", isSpangram: false },
                ],

                maxHints: 2,
                nextPage: "02-wordle.html",
            };

            // ============================================================
            // üéÆ SPIELLOGIK - AB HIER NICHTS √ÑNDERN! üéÆ
            // ============================================================

            let selectedCells = [];
            let foundWords = [];
            let hintsLeft = CONFIG.maxHints;
            let isMouseDown = false;
            let wordPaths = {};

            function findWordPath(word, grid, rows, cols) {
                const directions = [
                    [-1, -1],
                    [-1, 0],
                    [-1, 1],
                    [0, -1],
                    [0, 1],
                    [1, -1],
                    [1, 0],
                    [1, 1],
                ];

                function dfs(row, col, idx, visited) {
                    if (idx === word.length) return [];
                    if (row < 0 || row >= rows || col < 0 || col >= cols)
                        return null;
                    const key = `${row},${col}`;
                    if (visited.has(key)) return null;
                    if (grid[row][col] !== word[idx]) return null;

                    visited.add(key);
                    if (idx === word.length - 1) return [{ row, col }];

                    for (const [dr, dc] of directions) {
                        const result = dfs(
                            row + dr,
                            col + dc,
                            idx + 1,
                            new Set(visited),
                        );
                        if (result) return [{ row, col }, ...result];
                    }
                    return null;
                }

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (grid[r][c] === word[0]) {
                            const path = dfs(r, c, 0, new Set());
                            if (path) return path;
                        }
                    }
                }
                return null;
            }

            function validateGrid() {
                const errors = [];
                console.log("=== GITTER-VALIDIERUNG ===");
                console.log("Gitter:");
                CONFIG.grid.forEach((row, i) => console.log(`${i}: ${row}`));
                console.log("");

                for (const w of CONFIG.words) {
                    const path = findWordPath(
                        w.word,
                        CONFIG.grid,
                        CONFIG.rows,
                        CONFIG.cols,
                    );
                    if (!path) {
                        errors.push(w.word);
                        console.log(`‚ùå ${w.word}: NICHT GEFUNDEN`);
                    } else {
                        wordPaths[w.word] = path;
                        console.log(
                            `‚úì ${w.word}: ${path.map((p) => `(${p.row},${p.col})`).join("‚Üí")}`,
                        );
                    }
                }

                if (errors.length > 0) {
                    document
                        .getElementById("validation-error")
                        .classList.add("visible");
                    document.getElementById("error-list").innerHTML = errors
                        .map((w) => `<li>${w}</li>`)
                        .join("");
                    return false;
                }
                console.log("\n‚úÖ Alle W√∂rter gefunden!");
                return true;
            }

            function initGame() {
                document.getElementById("theme-text").textContent =
                    CONFIG.theme;
                document.getElementById("total-count").textContent =
                    CONFIG.words.length;
                document.getElementById("hints-left").textContent = hintsLeft;

                validateGrid();

                const gridEl = document.getElementById("grid");
                gridEl.style.gridTemplateColumns = `repeat(${CONFIG.cols}, 48px)`;

                for (let row = 0; row < CONFIG.rows; row++) {
                    for (let col = 0; col < CONFIG.cols; col++) {
                        const cell = document.createElement("div");
                        cell.className = "cell";
                        cell.textContent = CONFIG.grid[row][col];
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.addEventListener("mousedown", (e) =>
                            startSelection(e, cell),
                        );
                        cell.addEventListener("mouseenter", (e) =>
                            continueSelection(e, cell),
                        );
                        cell.addEventListener("touchstart", (e) => {
                            e.preventDefault();
                            startSelection(e, cell);
                        });
                        cell.addEventListener("touchmove", handleTouchMove);
                        gridEl.appendChild(cell);
                    }
                }

                document.addEventListener(
                    "mouseup",
                    () => (isMouseDown = false),
                );
                document.addEventListener(
                    "touchend",
                    () => (isMouseDown = false),
                );

                const foundWordsEl = document.getElementById("found-words");
                CONFIG.words.forEach((w) => {
                    const span = document.createElement("span");
                    span.className = "found-word";
                    span.textContent = w.isSpangram ? `‚≠ê ${w.word}` : w.word;
                    span.id = `word-${w.word}`;
                    foundWordsEl.appendChild(span);
                });

                createSnowflakes();
            }

            function startSelection(e, cell) {
                if (
                    cell.classList.contains("found") ||
                    cell.classList.contains("spangram")
                )
                    return;
                isMouseDown = true;
                clearSelection();
                addToSelection(cell);
            }

            function continueSelection(e, cell) {
                if (!isMouseDown) return;
                if (
                    cell.classList.contains("found") ||
                    cell.classList.contains("spangram")
                )
                    return;
                if (selectedCells.includes(cell)) return;

                if (selectedCells.length > 0) {
                    const last = selectedCells[selectedCells.length - 1];
                    const rowDiff = Math.abs(
                        parseInt(last.dataset.row) - parseInt(cell.dataset.row),
                    );
                    const colDiff = Math.abs(
                        parseInt(last.dataset.col) - parseInt(cell.dataset.col),
                    );
                    if (rowDiff <= 1 && colDiff <= 1) addToSelection(cell);
                }
            }

            function handleTouchMove(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const el = document.elementFromPoint(
                    touch.clientX,
                    touch.clientY,
                );
                if (el && el.classList.contains("cell"))
                    continueSelection(e, el);
            }

            function addToSelection(cell) {
                selectedCells.push(cell);
                cell.classList.add("selected");
                document.getElementById("current-word").textContent =
                    selectedCells.map((c) => c.textContent).join("");
            }

            function clearSelection() {
                selectedCells.forEach((c) => c.classList.remove("selected"));
                selectedCells = [];
                document.getElementById("current-word").textContent = "";
                document.getElementById("message").className = "message";
            }

            function submitWord() {
                const word = selectedCells.map((c) => c.textContent).join("");
                const wordConfig = CONFIG.words.find((w) => w.word === word);

                if (wordConfig && !foundWords.includes(word)) {
                    foundWords.push(word);
                    selectedCells.forEach((cell) => {
                        cell.classList.remove("selected");
                        cell.classList.add(
                            wordConfig.isSpangram ? "spangram" : "found",
                        );
                    });
                    document
                        .getElementById(`word-${word}`)
                        .classList.add("found");
                    document.getElementById("found-count").textContent =
                        foundWords.length;
                    selectedCells = [];
                    document.getElementById("current-word").textContent = "";

                    if (wordConfig.isSpangram) {
                        showMessage(
                            `üåü SPANGRAM! "${word}" gefunden! üåü`,
                            "success",
                        );
                    } else {
                        showMessage(`üéâ "${word}" gefunden!`, "success");
                    }

                    if (foundWords.length === CONFIG.words.length) {
                        setTimeout(() => {
                            showMessage(
                                "üéÑ FANTASTISCH! Alle W√∂rter gefunden! üéÑ",
                                "success",
                            );
                            document
                                .getElementById("next-button")
                                .classList.add("visible");
                        }, 1000);
                    }
                } else if (foundWords.includes(word)) {
                    showMessage("Schon gefunden!", "error");
                } else {
                    showMessage("Kein gesuchtes Wort.", "error");
                }
            }

            function showHint() {
                if (hintsLeft <= 0) {
                    showMessage("Keine Hinweise mehr!", "error");
                    return;
                }

                const remaining = CONFIG.words.filter(
                    (w) => !foundWords.includes(w.word),
                );
                if (remaining.length === 0) return;

                const hint =
                    remaining[Math.floor(Math.random() * remaining.length)];
                const path = wordPaths[hint.word];
                hintsLeft--;
                document.getElementById("hints-left").textContent = hintsLeft;

                if (path && path.length > 0) {
                    const firstCell = document.querySelector(
                        `[data-row="${path[0].row}"][data-col="${path[0].col}"]`,
                    );
                    if (
                        firstCell &&
                        !firstCell.classList.contains("found") &&
                        !firstCell.classList.contains("spangram")
                    ) {
                        firstCell.style.boxShadow = "0 0 20px 5px #ffd700";
                        firstCell.style.transform = "scale(1.15)";
                        setTimeout(() => {
                            firstCell.style.boxShadow = "";
                            firstCell.style.transform = "";
                        }, 2500);
                    }
                }

                const hintText = hint.isSpangram
                    ? `üí° SPANGRAM: "${hint.word}" (${hint.word.length} Buchstaben) - Start markiert!`
                    : `üí° "${hint.word}" (${hint.word.length} Buchstaben) - Start markiert!`;
                showMessage(hintText, "success");
            }

            function showMessage(text, type) {
                const msg = document.getElementById("message");
                msg.textContent = text;
                msg.className = `message ${type}`;
                if (type === "error")
                    setTimeout(() => (msg.className = "message"), 2000);
            }

            function goToNext() {
                window.location.href = CONFIG.nextPage;
            }

            function createSnowflakes() {
                const container = document.getElementById("snowflakes");
                for (let i = 0; i < 50; i++) {
                    const s = document.createElement("div");
                    s.className = "snowflake";
                    s.textContent = "‚ùÑ";
                    s.style.left = Math.random() * 100 + "%";
                    s.style.animationDuration = Math.random() * 3 + 2 + "s";
                    s.style.animationDelay = Math.random() * 5 + "s";
                    s.style.fontSize = Math.random() * 1 + 0.5 + "em";
                    container.appendChild(s);
                }
            }

            initGame();
        </script>
    </body>
</html>
